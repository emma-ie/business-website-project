<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Checkout | The Book Nook</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <!-- Bootstrap Navbar -->
    <nav class="navbar navbar-expand-md navbar-light bg-light mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">The Book Nook</a> <!-- Brand name linking to homepage -->

            <div>
                <!-- Takes user to homepage; nav-link applies Bootstrap link styling -->
                <a class="nav-link d-inline fs-5 me-3" href="/">Home</a>
                <!-- Takes user to shop page; nav-link applies Bootstrap link styling -->
                <a class="nav-link d-inline fs-5 me-3" href="/shop">Shop</a>
                <!-- Takes user to checkout page; nav-link applies Bootstrap link styling -->
                <a class="nav-link d-inline fs-5 me-3" href="/checkout">Checkout</a>
                <!-- Takes user to contact page; nav-link applies Bootstrap link styling -->
                <a class="nav-link d-inline fs-5 me-3" href="/contact">Contact</a>
            </div>
        </div>
    </nav>
    <!-- End Bootstrap Navbar -->

    <div class="container">
        <h1 class="text-center">Order Summary</h1>
        <h2>Thank you for your order, <%= name %></h2> <!-- EJS template inserts customers name -->
        <p><strong>Delivering to:</strong> <%= address %></p> <!-- EJS template inserts customers address -->
        <h3>Your order:</h3>
        <div id="basketItems"></div> <!-- Basket items displayed here -->
        <p id="totalPriceAll"></p> <!-- Total price displayed here -->
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
        integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
        crossorigin="anonymous"></script>

    <script>
        // This script is the same as in checkout.ejs to display basket items and total price
        // Check if there are items in the basket - if empty, display message
        let hasItems = false;
        // Loop through localStorage to check for items, using hasItems as flag
        for (i = 0; i < localStorage.length; i++) {
            let product = localStorage.key(i);
            let content = JSON.parse(localStorage.getItem(product));
            if (content.quantity > 0) {
                hasItems = true;
            }
        }

        // Initialising total price variable
        let totalPriceAll = 0;
        // Script to display cart items on page; taken from week 13 content
        for (i = 0; i < localStorage.length; i++) {
            let product = localStorage.key(i);
            let content = JSON.parse(localStorage.getItem(product));
            let totalCost = content.price * content.quantity;
            totalPriceAll += totalCost;
            if (content.quantity > 0) {
                // Display each item in the basket with quantity and total cost to 2 decimal places
                document.getElementById("basketItems").innerHTML += product + " x " + content.quantity + " = €" + totalCost.toFixed(2) + "<br>";
            }
        }
        document.getElementById("totalPriceAll").innerHTML = "Total: €" + totalPriceAll.toFixed(2); // Display total price to 2 decimal places

        // If no items in basket, display message instead
        if (!hasItems) {
            document.getElementById("basketItems").innerHTML = "Your basket is empty.";
        }
    </script>
</body>

</html>